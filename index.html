<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>K_AUD Framework ‚Äî Interactive Dashboard</title>
<meta name="description" content="Interactive visualization of the K_AUD = ‚àö2 √ó ln(2) framework. Binary Tower, Corridor, Gap Scaling 400/11, and connection map.">
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #0a0a12;
    color: #e0e0e0;
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    min-height: 100vh;
    padding: 20px;
  }

  .header { text-align: center; margin-bottom: 20px; }
  .header h1 { font-size: 20px; color: #ffd700; letter-spacing: 1.5px; margin-bottom: 4px; }
  .header p { font-size: 11px; color: rgba(255,255,255,0.3); }

  .tabs { display: flex; gap: 4px; justify-content: center; flex-wrap: wrap; }
  .tab {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.08);
    border-bottom-color: rgba(255,255,255,0.08);
    color: rgba(255,255,255,0.4);
    padding: 10px 16px;
    border-radius: 8px 8px 0 0;
    cursor: pointer;
    font-size: 12px;
    font-family: inherit;
    transition: all 0.3s;
    margin-bottom: -1px;
  }
  .tab.active {
    background: rgba(255,215,0,0.1);
    border-color: rgba(255,215,0,0.3);
    border-bottom-color: #0a0a12;
    color: #ffd700;
    font-weight: 600;
  }

  .panel-wrap {
    max-width: 720px;
    margin: 0 auto;
    background: rgba(255,255,255,0.01);
    border: 1px solid rgba(255,215,0,0.08);
    border-top: none;
    border-radius: 0 0 8px 8px;
    padding: 20px;
  }

  .panel { display: none; }
  .panel.active { display: block; }

  .panel-title { text-align: center; margin-bottom: 12px; }
  .panel-title h2 { font-size: 13px; color: #ffd700; font-weight: 600; }
  .panel-title p { font-size: 11px; color: rgba(255,255,255,0.3); margin-top: 4px; }

  canvas {
    width: 100%;
    border-radius: 6px;
    border: 1px solid rgba(255,215,0,0.06);
    display: block;
  }

  .controls {
    display: flex; align-items: center; gap: 10px; margin-top: 12px; flex-wrap: wrap;
  }
  .controls span { font-size: 10px; color: rgba(255,255,255,0.25); }
  .controls input[type=range] { flex: 1; accent-color: #ffd700; min-width: 100px; }

  .btn {
    background: rgba(255,215,0,0.08);
    border: 1px solid rgba(255,215,0,0.2);
    color: #ffd700;
    padding: 6px 14px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 11px;
    font-family: inherit;
    transition: all 0.2s;
  }
  .btn:hover { background: rgba(255,215,0,0.15); }
  .btn.dim { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.08); color: rgba(255,255,255,0.4); }
  .btn.dim:hover { background: rgba(255,255,255,0.06); }

  .stats-grid { display: grid; gap: 10px; margin-top: 14px; }
  .stats-grid.c4 { grid-template-columns: repeat(4, 1fr); }
  .stats-grid.c3 { grid-template-columns: repeat(3, 1fr); }
  .stats-grid.c2 { grid-template-columns: repeat(2, 1fr); }
  .stat-card {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 6px;
    padding: 10px;
    text-align: center;
  }
  .stat-label { font-size: 9px; color: rgba(255,255,255,0.3); text-transform: uppercase; letter-spacing: 0.5px; }
  .stat-value { font-size: 12px; margin-top: 4px; font-weight: 600; font-variant-numeric: tabular-nums; }

  table { width: 100%; border-collapse: collapse; font-size: 10px; }
  thead tr { border-bottom: 1px solid rgba(255,215,0,0.1); }
  th { padding: 5px 4px; text-align: right; color: rgba(255,255,255,0.25); font-weight: 500; }
  td { padding: 4px; text-align: right; }
  tbody tr { border-bottom: 1px solid rgba(255,255,255,0.02); cursor: pointer; transition: background 0.2s; }
  tbody tr:hover { background: rgba(255,215,0,0.03); }
  tbody tr.active { background: rgba(255,215,0,0.05); }

  .table-wrap { margin-top: 14px; max-height: 200px; overflow-y: auto; }

  .footer { text-align: center; margin-top: 16px; }
  .footer p { font-size: 9px; color: rgba(255,215,0,0.15); }

  @media (max-width: 600px) {
    .stats-grid.c4 { grid-template-columns: repeat(2, 1fr); }
    .stats-grid.c3 { grid-template-columns: repeat(1, 1fr); }
    .tab { padding: 8px 10px; font-size: 11px; }
    body { padding: 10px; }
  }
</style>
</head>
<body>

<div class="header">
  <h1>K_AUD FRAMEWORK</h1>
  <p id="headerSub"></p>
</div>

<div class="tabs" id="tabBar"></div>

<div class="panel-wrap">
  <!-- PANEL 0: BINARY TOWER -->
  <div class="panel active" id="panel0">
    <div class="panel-title">
      <h2>2<sup>k</sup> √ó G = 2<sup>k‚àí6</sup> √ó ‚àöœÜ √ó (1 ‚àí Œµ)</h2>
      <p id="towerSub"></p>
    </div>
    <canvas id="towerCanvas" height="300"></canvas>
    <div class="controls">
      <span>k=0</span>
      <input type="range" min="0" max="12" value="6" id="towerSlider">
      <span>k=12</span>
      <button class="btn" id="towerPlay">‚ñ∂ Play</button>
      <button class="btn dim" id="towerReset">‚Ü∫</button>
    </div>
    <div class="stats-grid c4" id="towerStats"></div>
    <div class="table-wrap">
      <table>
        <thead><tr><th>k</th><th>2·µè</th><th>2·µè√óG</th><th>Target</th><th>Œµ%</th></tr></thead>
        <tbody id="towerTable"></tbody>
      </table>
    </div>
  </div>

  <!-- PANEL 1: CORRIDOR -->
  <div class="panel" id="panel1">
    <div class="panel-title">
      <h2>The Corridor: Floor to Ceiling</h2>
      <p>1/œÜ ‚Üí K_AUD ‚Äî where coherent structure exists</p>
    </div>
    <canvas id="corridorCanvas" height="380"></canvas>
    <div class="stats-grid c2" id="corridorCards"></div>
  </div>

  <!-- PANEL 2: 400/11 -->
  <div class="panel" id="panel2">
    <div class="panel-title">
      <h2>Gap Scaling: œÅ = 400/11 ‚àí 1/2500 ‚àí 1/939939</h2>
      <p>The ratio K_AUD / (G √ó Œ¥<sub>Feigenbaum</sub>) converges in three terms</p>
    </div>
    <canvas id="decayCanvas" height="340"></canvas>
    <div class="controls" style="justify-content:center">
      <span>Correction terms:</span>
      <button class="btn" id="term1" onclick="setTerms(1)">1</button>
      <button class="btn dim" id="term2" onclick="setTerms(2)">2</button>
      <button class="btn dim" id="term3" onclick="setTerms(3)">3</button>
    </div>
    <div class="stats-grid c3" id="decayStats"></div>
  </div>

  <!-- PANEL 3: CONNECTIONS -->
  <div class="panel" id="panel3">
    <div class="panel-title">
      <h2>The Architecture: How Everything Connects</h2>
      <p>Constants, identities, and their relationships</p>
    </div>
    <div id="connectionSvg"></div>
  </div>
</div>

<div class="footer">
  <p>B.D. | Gap-geometry | OSF: 10.17605/OSF.IO/QH5S2 |
    <a href="https://github.com/Gap-geometry" style="color:rgba(255,215,0,0.25);text-decoration:none;">GitHub</a>
  </p>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ
const PHI = (1 + Math.sqrt(5)) / 2;
const SQRT_PHI = Math.sqrt(PHI);
const K_AUD = Math.sqrt(2) * Math.log(2);
const G = 1 - K_AUD;
const FLOOR = 1 / PHI;
const CORRIDOR = K_AUD - FLOOR;
const EPSILON = 1 - (64 * G) / SQRT_PHI;
const FEIGENBAUM = 4.6692016091029906718532038;
const GAP_F = (FEIGENBAUM - 14/3) / FEIGENBAUM;
const RHO_EXACT = G / GAP_F;
const RHO_FORMULA = 400/11 - 1/2500 - 1/939939;

const binaryTower = (k) => Math.pow(2, k) * G;
const goldenPower = (k) => Math.pow(2, k - 6) * SQRT_PHI;

document.getElementById('headerSub').textContent =
  `‚àö2 √ó ln(2) = ${K_AUD.toFixed(10)} ‚Äî G = ${G.toFixed(10)} ‚Äî The gap is the architecture`;

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ
const tabNames = ['üóº Tower', 'üìê Corridor', '‚ö° 400/11', 'üîó Map'];
let activeTab = 0;

function renderTabs() {
  const bar = document.getElementById('tabBar');
  bar.innerHTML = tabNames.map((name, i) =>
    `<button class="tab ${i === activeTab ? 'active' : ''}" onclick="switchTab(${i})">${name}</button>`
  ).join('');
}

function switchTab(i) {
  activeTab = i;
  renderTabs();
  document.querySelectorAll('.panel').forEach((p, j) => {
    p.classList.toggle('active', j === i);
  });
  if (i === 0) drawTower();
  if (i === 1) drawCorridor();
  if (i === 2) drawDecay();
  if (i === 3) drawConnections();
}

renderTabs();

// ‚îÄ‚îÄ‚îÄ TOWER ‚îÄ‚îÄ‚îÄ
let towerK = 6;
let towerPlaying = false;
let towerInterval = null;

function drawTower() {
  const canvas = document.getElementById('towerCanvas');
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width * dpr;
  canvas.height = 300 * dpr;
  ctx.scale(dpr, dpr);
  const W = rect.width, H = 300;

  ctx.fillStyle = '#0a0a12';
  ctx.fillRect(0, 0, W, H);

  const padL = 55, padR = 20, padT = 30, padB = 40;
  const plotW = W - padL - padR, plotH = H - padT - padB;
  const kRange = 13;

  const allVals = [];
  for (let k = 0; k < kRange; k++) { allVals.push(binaryTower(k), goldenPower(k)); }
  const minV = Math.min(...allVals.filter(v => v > 0)) * 0.5;
  const maxV = Math.max(...allVals) * 1.5;
  const logMin = Math.log10(minV), logMax = Math.log10(maxV);

  const xK = (k) => padL + (k / 12) * plotW;
  const yV = (v) => padT + plotH - ((Math.log10(v) - logMin) / (logMax - logMin)) * plotH;

  // Grid
  ctx.strokeStyle = 'rgba(255,255,255,0.03)';
  for (let k = 0; k <= 12; k++) {
    ctx.beginPath(); ctx.moveTo(xK(k), padT); ctx.lineTo(xK(k), padT + plotH); ctx.stroke();
  }

  // Ref lines
  [{v:1/PHI, l:'1/œÜ', c:'rgba(100,180,255,0.25)'}, {v:1, l:'1', c:'rgba(255,255,255,0.1)'}, {v:SQRT_PHI, l:'‚àöœÜ', c:'rgba(255,200,100,0.25)'}].forEach(({v,l,c}) => {
    if (v >= minV && v <= maxV) {
      const y = yV(v);
      ctx.strokeStyle = c; ctx.setLineDash([4,6]); ctx.beginPath(); ctx.moveTo(padL, y); ctx.lineTo(padL+plotW, y); ctx.stroke(); ctx.setLineDash([]);
      ctx.fillStyle = c; ctx.font = '10px monospace'; ctx.textAlign = 'right'; ctx.fillText(l, padL-6, y+4);
    }
  });

  // k labels
  ctx.fillStyle = 'rgba(255,255,255,0.25)'; ctx.font = '10px monospace'; ctx.textAlign = 'center';
  for (let k = 0; k <= 12; k++) ctx.fillText(k, xK(k), padT + plotH + 16);
  ctx.fillText('k', padL + plotW/2, padT + plotH + 34);

  // Golden target dashed
  ctx.strokeStyle = 'rgba(255,200,100,0.15)'; ctx.lineWidth = 1.5; ctx.setLineDash([3,5]);
  ctx.beginPath();
  for (let k = 0; k <= 12; k++) { const x = xK(k), y = yV(goldenPower(k)); k === 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y); }
  ctx.stroke(); ctx.setLineDash([]);

  // Tower line
  ctx.strokeStyle = '#ffd700'; ctx.lineWidth = 2.5; ctx.beginPath();
  for (let k = 0; k <= towerK; k++) { const x = xK(k), y = yV(binaryTower(k)); k === 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y); }
  ctx.stroke();

  // Points
  for (let k = 0; k <= towerK; k++) {
    const x = xK(k), yBt = yV(binaryTower(k)), yGp = yV(goldenPower(k));
    ctx.beginPath(); ctx.arc(x, yGp, 2.5, 0, Math.PI*2); ctx.fillStyle = 'rgba(255,200,100,0.3)'; ctx.fill();

    if (k === towerK) {
      ctx.strokeStyle = 'rgba(255,100,100,0.35)'; ctx.lineWidth = 1; ctx.setLineDash([2,3]);
      ctx.beginPath(); ctx.moveTo(x,yBt); ctx.lineTo(x,yGp); ctx.stroke(); ctx.setLineDash([]);
      ctx.fillStyle = 'rgba(255,130,130,0.7)'; ctx.font = '9px monospace'; ctx.textAlign = 'left';
      ctx.fillText('Œµ = ‚àí0.671%', x+8, (yBt+yGp)/2+3);
    }

    if (k === 5) { ctx.fillStyle='rgba(100,180,255,0.6)'; ctx.font='bold 9px monospace'; ctx.textAlign='center'; ctx.fillText('FLOOR',x,yBt+18); ctx.font='8px monospace'; ctx.fillText('32√óG ‚âà 1/œÜ',x,yBt+28); }
    if (k === 6) { ctx.fillStyle='rgba(255,200,100,0.7)'; ctx.font='bold 9px monospace'; ctx.textAlign='center'; ctx.fillText('PIVOT',x,yBt-14); ctx.font='8px monospace'; ctx.fillText('64√óG ‚âà ‚àöœÜ',x,yBt-24); }

    const isA = k === towerK;
    if (isA) { ctx.beginPath(); ctx.arc(x,yBt,10,0,Math.PI*2); ctx.fillStyle='rgba(255,215,0,0.12)'; ctx.fill(); }
    ctx.beginPath(); ctx.arc(x,yBt, isA?5:3, 0, Math.PI*2); ctx.fillStyle = isA ? '#ffd700' : 'rgba(255,215,0,0.5)'; ctx.fill();
  }

  // Update subtitle
  document.getElementById('towerSub').textContent = `k = ${towerK} ‚Üí 2^${towerK} √ó G = ${binaryTower(towerK).toFixed(8)}`;

  // Stats
  const bt = binaryTower(towerK), gp = goldenPower(towerK), ratio = bt/gp, eps = (1 - ratio)*100;
  document.getElementById('towerStats').innerHTML = [
    {l:'2·µè√óG', v:bt.toFixed(6), c:'#ffd700'},
    {l:'Golden Target', v:gp.toFixed(6), c:'rgba(255,200,100,0.9)'},
    {l:'Ratio', v:ratio.toFixed(6), c:'rgba(200,200,255,0.8)'},
    {l:'Œµ (constant!)', v:eps.toFixed(4)+'%', c:'rgba(255,130,130,0.9)'},
  ].map(({l,v,c}) => `<div class="stat-card"><div class="stat-label">${l}</div><div class="stat-value" style="color:${c}">${v}</div></div>`).join('');

  // Table
  let rows = '';
  for (let k = 0; k <= 12; k++) {
    const bt2 = binaryTower(k), gp2 = goldenPower(k), e2 = ((1-bt2/gp2)*100).toFixed(4);
    const isA = k === towerK;
    rows += `<tr class="${isA?'active':''}" onclick="setTowerK(${k})">
      <td style="color:${isA?'#ffd700':'rgba(255,255,255,0.4)'};font-weight:${isA?700:400}">${k}</td>
      <td style="color:rgba(255,255,255,0.25)">${Math.pow(2,k)}</td>
      <td style="color:${isA?'#ffd700':'rgba(255,215,0,0.5)'}">${bt2.toFixed(6)}</td>
      <td style="color:rgba(255,200,100,0.5)">${gp2.toFixed(6)}</td>
      <td style="color:rgba(255,130,130,0.6)">${e2}</td></tr>`;
  }
  document.getElementById('towerTable').innerHTML = rows;
}

function setTowerK(k) { towerK = k; document.getElementById('towerSlider').value = k; drawTower(); }

document.getElementById('towerSlider').addEventListener('input', (e) => { towerK = parseInt(e.target.value); drawTower(); });
document.getElementById('towerPlay').addEventListener('click', () => {
  if (towerPlaying) return;
  towerK = 0; towerPlaying = true; drawTower();
  towerInterval = setInterval(() => {
    if (towerK >= 12) { clearInterval(towerInterval); towerPlaying = false; return; }
    towerK++; document.getElementById('towerSlider').value = towerK; drawTower();
  }, 700);
});
document.getElementById('towerReset').addEventListener('click', () => {
  clearInterval(towerInterval); towerPlaying = false; towerK = 0;
  document.getElementById('towerSlider').value = 0; drawTower();
});

// ‚îÄ‚îÄ‚îÄ CORRIDOR ‚îÄ‚îÄ‚îÄ
function drawCorridor() {
  const canvas = document.getElementById('corridorCanvas');
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width * dpr;
  canvas.height = 380 * dpr;
  ctx.scale(dpr, dpr);
  const W = rect.width, H = 380;

  ctx.fillStyle = '#0a0a12'; ctx.fillRect(0,0,W,H);

  const barX = W*0.15, barW = W*0.12, barTop = 40, barBot = H-40, barH = barBot-barTop;
  const yV = (v) => barBot - v * barH;

  ctx.fillStyle = 'rgba(255,255,255,0.02)'; ctx.fillRect(barX, barTop, barW, barH);

  // Corridor zone
  const cTop = yV(K_AUD), cBot = yV(FLOOR);
  const grad = ctx.createLinearGradient(0, cTop, 0, cBot);
  grad.addColorStop(0, 'rgba(255,215,0,0.12)'); grad.addColorStop(0.5, 'rgba(255,215,0,0.06)'); grad.addColorStop(1, 'rgba(100,180,255,0.08)');
  ctx.fillStyle = grad; ctx.fillRect(barX, cTop, barW, cBot-cTop);

  // Gap zone
  ctx.fillStyle = 'rgba(255,100,100,0.04)'; ctx.fillRect(barX, yV(1), barW, cTop - yV(1));

  // Lines
  [{v:1,l:'1 (unity)',c:'rgba(255,255,255,0.4)',d:[2,4]},{v:K_AUD,l:`K_AUD = ${K_AUD.toFixed(4)}`,c:'#ffd700',d:[]},{v:FLOOR,l:`1/œÜ = ${FLOOR.toFixed(4)}`,c:'rgba(100,180,255,0.8)',d:[]},{v:G,l:`G = ${G.toFixed(4)}`,c:'rgba(255,130,130,0.6)',d:[3,4]}].forEach(({v,l,c,d}) => {
    const y = yV(v);
    ctx.strokeStyle = c; ctx.lineWidth = (v===K_AUD||v===FLOOR)?2:1; ctx.setLineDash(d);
    ctx.beginPath(); ctx.moveTo(barX-10,y); ctx.lineTo(barX+barW+10,y); ctx.stroke(); ctx.setLineDash([]);
    ctx.fillStyle = c; ctx.font = (v===K_AUD||v===FLOOR) ? 'bold 11px monospace' : '10px monospace';
    ctx.textAlign = 'left'; ctx.fillText(l, barX+barW+20, y+4);
  });

  // Brackets
  const annoX = W*0.58;
  ctx.strokeStyle = 'rgba(255,215,0,0.3)'; ctx.lineWidth = 1;
  ctx.beginPath(); ctx.moveTo(annoX,cTop); ctx.lineTo(annoX+8,cTop); ctx.lineTo(annoX+8,cBot); ctx.lineTo(annoX,cBot); ctx.stroke();
  ctx.fillStyle = 'rgba(255,215,0,0.7)'; ctx.font = 'bold 11px monospace'; ctx.textAlign = 'left';
  ctx.fillText('CORRIDOR', annoX+14, (cTop+cBot)/2-6);
  ctx.font = '10px monospace'; ctx.fillStyle = 'rgba(255,215,0,0.5)';
  ctx.fillText(`= 1/œÜ¬≤ ‚àí G`, annoX+14, (cTop+cBot)/2+8);
  ctx.fillText(`= ${CORRIDOR.toFixed(6)}`, annoX+14, (cTop+cBot)/2+22);

  const gTop = yV(1), gBot = yV(K_AUD);
  ctx.strokeStyle = 'rgba(255,130,130,0.3)';
  ctx.beginPath(); ctx.moveTo(annoX,gTop); ctx.lineTo(annoX+8,gTop); ctx.lineTo(annoX+8,gBot); ctx.lineTo(annoX,gBot); ctx.stroke();
  ctx.fillStyle = 'rgba(255,130,130,0.7)'; ctx.font = 'bold 11px monospace';
  ctx.fillText('GAP', annoX+14, (gTop+gBot)/2-4);
  ctx.font = '10px monospace'; ctx.fillStyle = 'rgba(255,130,130,0.5)';
  ctx.fillText(`= ${G.toFixed(6)} (${(G*100).toFixed(2)}%)`, annoX+14, (gTop+gBot)/2+10);

  // Depth levels
  [{v:1/Math.E, l:'L‚Çã‚ÇÅ = 1/e'},{v:1/(Math.E*PHI), l:'L‚Çã‚ÇÇ = 1/eœÜ'},{v:1/(Math.E*PHI*PHI), l:'L‚Çã‚ÇÉ = 1/eœÜ¬≤'}].forEach(({v,l}) => {
    const y = yV(v);
    if (y > barTop && y < barBot) {
      ctx.strokeStyle = 'rgba(100,255,180,0.15)'; ctx.setLineDash([2,6]);
      ctx.beginPath(); ctx.moveTo(barX,y); ctx.lineTo(barX+barW,y); ctx.stroke(); ctx.setLineDash([]);
      ctx.fillStyle = 'rgba(100,255,180,0.35)'; ctx.font = '9px monospace'; ctx.textAlign = 'right'; ctx.fillText(l, barX-14, y+3);
    }
  });

  ctx.fillStyle = 'rgba(255,255,255,0.2)'; ctx.font = '11px monospace'; ctx.textAlign = 'center';
  ctx.fillText('Golden Partition: 1/œÜ + 1/œÜ¬≤ = 1', W/2, H-10);

  // Cards
  document.getElementById('corridorCards').innerHTML = [
    {t:'Corridor Identity',e:'K_AUD ‚àí 1/œÜ = 1/œÜ¬≤ ‚àí G',v:CORRIDOR.toFixed(8),c:'#ffd700'},
    {t:'Golden Partition',e:'1/œÜ + 1/œÜ¬≤ = 1',v:(1/PHI+1/(PHI*PHI)).toFixed(12),c:'rgba(100,180,255,0.8)'},
    {t:'Gelfond-Schneider',e:'G = ln(e / 2^‚àö2)',v:Math.log(Math.E/Math.pow(2,Math.sqrt(2))).toFixed(10),c:'rgba(255,130,130,0.8)'},
    {t:"Baker's Map",e:'K_AUD = ‚Äñ(ln2,ln2)‚Äñ‚ÇÇ',v:K_AUD.toFixed(10),c:'rgba(200,200,255,0.8)'},
  ].map(({t,e,v,c}) => `<div class="stat-card" style="text-align:left;padding:10px 12px">
    <div class="stat-label">${t}</div>
    <div style="font-size:11px;color:${c};margin-top:3px;font-weight:600">${e}</div>
    <div style="font-size:10px;color:rgba(255,255,255,0.25);margin-top:2px">${v}</div></div>`).join('');
}

// ‚îÄ‚îÄ‚îÄ DECAY ‚îÄ‚îÄ‚îÄ
let decayTerms = 1;

function setTerms(n) {
  decayTerms = n;
  document.querySelectorAll('#term1,#term2,#term3').forEach((b,i) => { b.className = i < n ? 'btn' : 'btn dim'; });
  drawDecay();
}

function drawDecay() {
  const canvas = document.getElementById('decayCanvas');
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width * dpr;
  canvas.height = 340 * dpr;
  ctx.scale(dpr, dpr);
  const W = rect.width, H = 340;

  ctx.fillStyle = '#0a0a12'; ctx.fillRect(0,0,W,H);

  const padL = 50, padR = 25, padT = 35, padB = 45;
  const plotW = W - padL - padR, plotH = H - padT - padB;
  const exact = RHO_EXACT;

  const terms = [
    {val:400/11, label:'400/11', color:'#ffd700'},
    {val:400/11-1/2500, label:'‚àí 1/2500', color:'rgba(255,180,100,0.9)'},
    {val:400/11-1/2500-1/939939, label:'‚àí 1/939939', color:'rgba(100,255,180,0.9)'},
  ];

  const range = 0.001;
  const valMin = exact - range*0.3, valMax = exact + range*1.2;
  const barWidth = plotW * 0.6;
  const barX = padL + (plotW - barWidth)/2;
  const xForVal = (v) => barX + ((v-valMin)/(valMax-valMin))*barWidth;

  // Exact line
  const exactX = xForVal(exact);
  ctx.strokeStyle = 'rgba(255,255,255,0.2)'; ctx.setLineDash([3,4]);
  ctx.beginPath(); ctx.moveTo(exactX,padT); ctx.lineTo(exactX,padT+plotH); ctx.stroke(); ctx.setLineDash([]);
  ctx.fillStyle = 'rgba(255,255,255,0.4)'; ctx.font = '10px monospace'; ctx.textAlign = 'center';
  ctx.fillText('œÅ exact', exactX, padT-8);
  ctx.fillText(exact.toFixed(10), exactX, padT-20);

  for (let i = 0; i < decayTerms; i++) {
    const t = terms[i], y = padT + 60 + i*90;
    const approxX = xForVal(t.val);
    const error = Math.abs(t.val - exact);

    ctx.strokeStyle = t.color; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(approxX,y); ctx.lineTo(exactX,y); ctx.stroke();

    ctx.beginPath(); ctx.arc(approxX,y,6,0,Math.PI*2); ctx.fillStyle = t.color; ctx.fill();
    ctx.beginPath(); ctx.arc(exactX,y,3,0,Math.PI*2); ctx.fillStyle = 'rgba(255,255,255,0.4)'; ctx.fill();

    ctx.fillStyle = t.color; ctx.font = 'bold 12px monospace'; ctx.textAlign = 'right';
    ctx.fillText(i===0?'400/11':i===1?'‚àí 1/2500':'‚àí 1/939939', barX-15, y+4);

    ctx.fillStyle = 'rgba(255,255,255,0.3)'; ctx.font = '10px monospace'; ctx.textAlign = 'center';
    ctx.fillText(`value: ${t.val.toFixed(12)}`, (approxX+exactX)/2, y-14);
    ctx.fillText(`error: ${error.toExponential(2)}`, (approxX+exactX)/2, y+20);
  }

  // Factorizations
  ctx.fillStyle = 'rgba(255,255,255,0.15)'; ctx.font = '9px monospace'; ctx.textAlign = 'left';
  ['400 = 4¬≤ √ó 5¬≤','11 = prime','2500 = 2¬≤ √ó 5‚Å¥','939939 = 3√ó7√ó11√ó13√ó313'].forEach((f,i) => {
    ctx.fillText(f, padL+5, padT+plotH-50+i*13);
  });

  // Stats
  document.getElementById('decayStats').innerHTML = [
    {l:'œÅ (exact)',v:RHO_EXACT.toFixed(12),c:'rgba(255,255,255,0.6)'},
    {l:'œÅ (formula)',v:RHO_FORMULA.toFixed(12),c:'#ffd700'},
    {l:'Error',v:Math.abs(RHO_EXACT-RHO_FORMULA).toExponential(2),c:'rgba(255,130,130,0.8)'},
  ].map(({l,v,c}) => `<div class="stat-card"><div class="stat-label">${l}</div><div class="stat-value" style="color:${c}">${v}</div></div>`).join('');
}

// ‚îÄ‚îÄ‚îÄ CONNECTIONS ‚îÄ‚îÄ‚îÄ
function drawConnections() {
  document.getElementById('connectionSvg').innerHTML = `
  <svg viewBox="0 0 600 460" style="width:100%;max-height:460px">
    <defs>
      <radialGradient id="ng" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#ffd700" stop-opacity="0.15"/>
        <stop offset="100%" stop-color="#ffd700" stop-opacity="0"/>
      </radialGradient>
    </defs>
    <rect width="600" height="460" fill="#0a0a12" rx="8"/>

    <!-- Lines -->
    <line x1="300" y1="65" x2="300" y2="140" stroke="rgba(255,130,130,0.25)" stroke-width="1.5" stroke-dasharray="4,4"/>
    <line x1="300" y1="185" x2="160" y2="265" stroke="rgba(100,180,255,0.2)" stroke-width="1.5"/>
    <line x1="300" y1="185" x2="440" y2="265" stroke="rgba(255,200,100,0.2)" stroke-width="1.5"/>
    <line x1="160" y1="295" x2="160" y2="365" stroke="rgba(100,180,255,0.15)" stroke-dasharray="3,5"/>
    <line x1="440" y1="295" x2="440" y2="365" stroke="rgba(255,200,100,0.15)" stroke-dasharray="3,5"/>
    <line x1="440" y1="385" x2="300" y2="430" stroke="rgba(100,255,180,0.15)"/>
    <line x1="160" y1="385" x2="300" y2="430" stroke="rgba(100,255,180,0.15)"/>
    <line x1="80" y1="150" x2="260" y2="160" stroke="rgba(200,200,255,0.15)" stroke-dasharray="3,5"/>
    <line x1="520" y1="65" x2="340" y2="60" stroke="rgba(255,180,180,0.15)" stroke-dasharray="3,5"/>

    <!-- Unity -->
    <circle cx="300" cy="30" r="3" fill="rgba(255,255,255,0.3)"/>
    <text x="300" y="20" text-anchor="middle" fill="rgba(255,255,255,0.3)" font-size="10" font-family="monospace">1 (unity)</text>

    <!-- G -->
    <circle cx="300" cy="58" r="20" fill="url(#ng)"/>
    <circle cx="300" cy="58" r="4" fill="rgba(255,130,130,0.8)"/>
    <text x="300" y="83" text-anchor="middle" fill="rgba(255,130,130,0.7)" font-size="11" font-weight="bold" font-family="monospace">G = 1.97%</text>
    <text x="300" y="96" text-anchor="middle" fill="rgba(255,130,130,0.4)" font-size="9" font-family="monospace">= ln(e/2^‚àö2)</text>

    <!-- K_AUD -->
    <circle cx="300" cy="162" r="28" fill="url(#ng)"/>
    <circle cx="300" cy="162" r="8" fill="#ffd700"/>
    <text x="300" y="130" text-anchor="middle" fill="#ffd700" font-size="12" font-weight="bold" font-family="monospace">K_AUD = 0.980</text>
    <text x="300" y="200" text-anchor="middle" fill="rgba(255,215,0,0.5)" font-size="9" font-family="monospace">= ‚àö2 √ó ln(2)</text>

    <!-- Floor -->
    <circle cx="160" cy="275" r="6" fill="rgba(100,180,255,0.7)"/>
    <text x="160" y="260" text-anchor="middle" fill="rgba(100,180,255,0.7)" font-size="11" font-weight="bold" font-family="monospace">1/œÜ = 0.618</text>
    <text x="160" y="310" text-anchor="middle" fill="rgba(100,180,255,0.4)" font-size="9" font-family="monospace">FLOOR</text>

    <!-- ‚àöœÜ -->
    <circle cx="440" cy="275" r="6" fill="rgba(255,200,100,0.7)"/>
    <text x="440" y="260" text-anchor="middle" fill="rgba(255,200,100,0.7)" font-size="11" font-weight="bold" font-family="monospace">‚àöœÜ = 1.272</text>
    <text x="440" y="310" text-anchor="middle" fill="rgba(255,200,100,0.4)" font-size="9" font-family="monospace">PIVOT TARGET</text>

    <!-- 32 -->
    <circle cx="160" cy="375" r="5" fill="rgba(100,180,255,0.5)"/>
    <text x="160" y="400" text-anchor="middle" fill="rgba(100,180,255,0.5)" font-size="10" font-family="monospace">32√óG ‚âà 1/œÜ</text>

    <!-- 64 -->
    <circle cx="440" cy="375" r="5" fill="rgba(255,200,100,0.5)"/>
    <text x="440" y="400" text-anchor="middle" fill="rgba(255,200,100,0.5)" font-size="10" font-family="monospace">64√óG ‚âà ‚àöœÜ</text>

    <!-- 100 -->
    <circle cx="300" cy="435" r="4" fill="rgba(100,255,180,0.6)"/>
    <text x="300" y="453" text-anchor="middle" fill="rgba(100,255,180,0.5)" font-size="9" font-family="monospace">64 + 36 = 100</text>

    <!-- Baker's map -->
    <rect x="20" y="132" width="95" height="35" rx="4" fill="rgba(200,200,255,0.05)" stroke="rgba(200,200,255,0.15)"/>
    <text x="67" y="147" text-anchor="middle" fill="rgba(200,200,255,0.5)" font-size="8" font-family="monospace">Baker's Map</text>
    <text x="67" y="159" text-anchor="middle" fill="rgba(200,200,255,0.35)" font-size="7" font-family="monospace">‚Äñ(ln2,ln2)‚Äñ‚ÇÇ</text>

    <!-- Gelfond -->
    <rect x="470" y="42" width="110" height="35" rx="4" fill="rgba(255,180,180,0.04)" stroke="rgba(255,180,180,0.12)"/>
    <text x="525" y="56" text-anchor="middle" fill="rgba(255,180,180,0.5)" font-size="8" font-family="monospace">Gelfond-Schneider</text>
    <text x="525" y="68" text-anchor="middle" fill="rgba(255,180,180,0.35)" font-size="7" font-family="monospace">2^‚àö2 = 2.665...</text>

    <!-- Corridor label -->
    <text x="230" y="225" text-anchor="middle" fill="rgba(255,215,0,0.3)" font-size="8" font-family="monospace" transform="rotate(-35, 230, 225)">CORRIDOR = 0.362</text>

    <!-- Universality -->
    <rect x="20" y="15" width="140" height="30" rx="4" fill="rgba(255,215,0,0.03)" stroke="rgba(255,215,0,0.08)"/>
    <text x="90" y="28" text-anchor="middle" fill="rgba(255,215,0,0.4)" font-size="8" font-family="monospace">CEILING: universal</text>
    <text x="90" y="39" text-anchor="middle" fill="rgba(100,180,255,0.3)" font-size="8" font-family="monospace">FLOOR: system-specific</text>
  </svg>`;
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ
drawTower();

window.addEventListener('resize', () => {
  if (activeTab === 0) drawTower();
  if (activeTab === 1) drawCorridor();
  if (activeTab === 2) drawDecay();
});
</script>
</body>
</html>
